# Segment Anything Model (SAM) Manifest
# Promptable image segmentation

model:
  name: segment_anything
  family: sam
  variants:
    - sam_vit_h
    - sam_vit_l
    - sam_vit_b
    - sam2_hiera_tiny
    - sam2_hiera_small
    - sam2_hiera_base
    - sam2_hiera_large
    - mobile_sam
    - fast_sam
  default_variant: sam2_hiera_base

source:
  type: huggingface
  repo: facebook/sam2-hiera-base-plus
  alternatives:
    - facebook/sam-vit-huge
    - facebook/sam-vit-large
    - facebook/sam-vit-base

input:
  image:
    type: image
    format: rgb
    preprocessing:
      resize:
        method: resize_longest
        target_size: 1024
      normalize:
        mean: [0.485, 0.456, 0.406]
        std: [0.229, 0.224, 0.225]
        scale: 255.0

  # Optional prompts (at least one required for inference)
  prompts:
    point:
      type: points
      format: xy
      description: Point coordinates [N, 2] with labels [N] (1=foreground, 0=background)
    box:
      type: boxes
      format: xyxy
      description: Bounding boxes [N, 4] in xyxy format
    mask:
      type: mask
      format: binary
      description: Low-res mask input for refinement

output:
  type: segmentation
  fields:
    - name: masks
      dtype: bool
      shape: [N, H, W]
      description: Binary segmentation masks
    - name: scores
      dtype: float32
      shape: [N]
      description: Mask quality scores (IoU prediction)
    - name: low_res_masks
      dtype: float32
      shape: [N, 256, 256]
      description: Low-resolution logits for refinement

postprocessing:
  # Resize masks to original image size
  resize_to_original: true
  # Score threshold for mask selection
  score_threshold: 0.0
  # Return all 3 mask predictions or just best
  return_single_mask: true

ros:
  publishers:
    - topic: masks
      msg_type: SegmentationMask
      frame_id: camera_frame
      description: Binary segmentation masks
    - topic: visualization
      msg_type: sensor_msgs/Image
      encoding: rgb8
      description: Image with mask overlay

  subscribers:
    - topic: point_prompt
      msg_type: geometry_msgs/PointStamped
      description: Single point prompt (foreground)
    - topic: box_prompt
      msg_type: geometry_msgs/Polygon
      description: Bounding box prompt

  services:
    - name: segment
      srv_type: Infer
      description: Segment with custom prompts
    - name: segment_all
      srv_type: Infer
      description: Automatic mask generation (no prompts)

  parameters:
    - name: auto_mode
      type: bool
      default: false
      description: Automatic mask generation without prompts
    - name: points_per_side
      type: int
      default: 32
      description: Grid density for auto mode
    - name: pred_iou_thresh
      type: float
      default: 0.88
      description: IoU threshold for auto mode filtering
    - name: stability_score_thresh
      type: float
      default: 0.95
      description: Stability threshold for auto mode

resources:
  vram:
    sam_vit_b: 2500
    sam_vit_l: 4000
    sam_vit_h: 6000
    sam2_hiera_tiny: 1500
    sam2_hiera_small: 2000
    sam2_hiera_base: 3000
    sam2_hiera_large: 5000
    mobile_sam: 500
    fast_sam: 800
